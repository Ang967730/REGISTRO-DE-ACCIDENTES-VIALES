<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Estad칤sticas Avanzadas - Siniestros Viales Chiapas</title>
  <link rel="stylesheet" href="base.css">
  <link rel="stylesheet" href="estadisticas.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>
</head>
<body>

  <!-- Encabezado -->
  <header>
    <img src="fondo-tuxtla.jpg" alt="Fondo de Tuxtla" class="fondo">
    <div class="logo">
      <img src="logo-smyt.png" alt="Logo Secretar칤a de Movilidad y Transporte">
    </div>
    <div class="titulo">
      <h1>游늵 Estad칤sticas Avanzadas</h1>
      <p>Estado de Chiapas 췅 Secretar칤a de Movilidad y Transporte</p>
      <p class="estrategia-nacional">Estrategia Nacional de Movilidad y Seguridad Vial</p>
    </div>
  </header>

  <!-- Men칰 de navegaci칩n -->
  <nav class="menu">
    <a href="index.html"><button><i class="fas fa-home"></i> Inicio</button></a>
    <a href="registro.html"><button><i class="fas fa-plus-circle"></i> Registro de Incidentes</button></a>
    <a href="mapa.html"><button><i class="fas fa-map-marked-alt"></i> Mapa de Incidentes</button></a>
    <a href="estadisticas.html" class="active"><button><i class="fas fa-chart-line"></i> Estad칤sticas y An치lisis</button></a>
  </nav>

  <!-- Contenido principal -->
  <main class="contenido-principal">
    
    <!-- Resumen General -->
    <section class="resumen-general">
      <h2><i class="fas fa-chart-bar"></i> Resumen General</h2>
      <div class="stats-grid-main">
        <div class="stat-card">
          <div class="stat-icon"><i class="fas fa-exclamation-triangle"></i></div>
          <div class="stat-info">
            <div class="stat-number" id="totalIncidentes">0</div>
            <div class="stat-label">Total de Incidentes</div>
          </div>
        </div>
        <div class="stat-card">
          <div class="stat-icon"><i class="fas fa-skull"></i></div>
          <div class="stat-info">
            <div class="stat-number" id="totalFallecidosGeneral">0</div>
            <div class="stat-label">Total de Fallecidos</div>
          </div>
        </div>
        <div class="stat-card">
          <div class="stat-icon"><i class="fas fa-users"></i></div>
          <div class="stat-info">
            <div class="stat-number" id="totalInvolucrados">0</div>
            <div class="stat-label">Total de Involucrados</div>
          </div>
        </div>
        <div class="stat-card">
          <div class="stat-icon"><i class="fas fa-percentage"></i></div>
          <div class="stat-info">
            <div class="stat-number" id="tasaLetalidadGeneral">0%</div>
            <div class="stat-label">Tasa de Letalidad</div>
          </div>
        </div>
      </div>
    </section>

    <!-- Selector de Municipio Global Mejorado -->
    <section class="filtro-municipio-global">
      <div class="filtro-municipio-header">
        <h3>
          <i class="fas fa-map-marker-alt"></i> 
          Filtrar por Municipio
        </h3>
        <p class="filtro-municipio-descripcion">
          Selecciona un municipio para filtrar todas las gr치ficas y estad칤sticas del dashboard
        </p>
      </div>
      
      <div id="municipioFilterContainer" class="municipio-filter-container">
        <div class="selector-wrapper">
          <label for="filtroMunicipio">
            <i class="fas fa-city"></i> Municipio:
          </label>
          <select id="filtroMunicipio" onchange="cambiarFiltroMunicipio()" class="municipio-selector">
            <option value="">Todos los municipios</option>
          </select>
        </div>
        
        <button class="btn-clear-municipio" onclick="limpiarFiltroMunicipio()" style="display: none;">
          <i class="fas fa-times-circle"></i> Quitar Filtro
        </button>
      </div>
      
      <div class="filtro-stats">
        <div class="stat-mini">
          <i class="fas fa-database"></i>
          <span>Cargando estad칤sticas...</span>
        </div>
      </div>
    </section>

    <!-- Panel 1: An치lisis Temporal y Geoespacial -->
    <section class="analytics-panel">
      <button class="analytics-toggle" onclick="togglePanel('temporal')">
        <span><i class="fas fa-chart-line"></i> An치lisis Temporal y Geoespacial</span>
        <i class="fas fa-chevron-down" id="temporalToggleIcon"></i>
      </button>
      <div class="analytics-content" id="temporalContent">
        
        <!-- M칠tricas Temporales -->
        <div class="analytics-grid">
          <div class="metric-card">
            <div class="metric-icon"><i class="fas fa-city"></i></div>
            <h4>Municipio M치s Peligroso</h4>
            <div class="metric-value" id="municipioPeligroso">---</div>
            <div class="metric-detail" id="municipioDetalle">Cargando...</div>
          </div>
          <div class="metric-card">
            <div class="metric-icon"><i class="fas fa-calendar-day"></i></div>
            <h4>D칤a M치s Peligroso</h4>
            <div class="metric-value" id="diaPeligroso">---</div>
            <div class="metric-detail" id="diaDetalle">Cargando...</div>
          </div>
          <div class="metric-card">
            <div class="metric-icon"><i class="fas fa-map-pin"></i></div>
            <h4>Zonas Cr칤ticas</h4>
            <div class="metric-value" id="zonasCriticas">0</div>
            <div class="metric-detail" id="zonasDetalle">Cargando...</div>
          </div>
          <div class="metric-card">
            <div class="metric-icon"><i class="fas fa-trending-up"></i></div>
            <h4>Tendencia</h4>
            <div class="metric-value" id="tendencia">--</div>
            <div class="metric-detail" id="tendenciaDetalle">Cargando...</div>
          </div>
        </div>
        
        <!-- Gr치ficas temporales -->
        <div class="charts-container">
          <div class="chart-card">
            <h4><i class="fas fa-calendar-week"></i> Distribuci칩n por D칤a de la Semana</h4>
            <canvas id="chartDias"></canvas>
          </div>
          <div class="chart-card">
            <h4><i class="fas fa-city"></i> Top 10 Municipios con M치s Incidentes</h4>
            <canvas id="chartMunicipios"></canvas>
          </div>
        </div>
    </section>

    <!-- Panel 2: Perfil de Siniestros -->
    <section class="analytics-panel">
      <button class="analytics-toggle" onclick="togglePanel('perfil')">
        <span><i class="fas fa-chart-pie"></i> Perfil de Siniestros</span>
        <i class="fas fa-chevron-down" id="perfilToggleIcon"></i>
      </button>
      <div class="analytics-content" id="perfilContent" style="display: none;">
        
        <!-- M칠tricas r치pidas -->
        <div class="quick-metrics-grid">
          <div class="metric-card-small">
            <div class="metric-icon-small"><i class="fas fa-skull"></i></div>
            <div class="metric-label">Total Fallecidos</div>
            <div class="metric-big" id="totalFallecidos">0</div>
            <div class="metric-change" id="cambioFallecidos">en todos los registros</div>
          </div>
          <div class="metric-card-small">
            <div class="metric-icon-small"><i class="fas fa-users"></i></div>
            <div class="metric-label">Promedio Involucrados</div>
            <div class="metric-big" id="promedioInvolucrados">0</div>
            <div class="metric-change">por incidente</div>
          </div>
          <div class="metric-card-small">
            <div class="metric-icon-small"><i class="fas fa-percentage"></i></div>
            <div class="metric-label">Tasa de Letalidad</div>
            <div class="metric-big" id="tasaLetalidad">0%</div>
            <div class="metric-change">fallecidos/involucrados</div>
          </div>
          <div class="metric-card-small">
            <div class="metric-icon-small"><i class="fas fa-exclamation-circle"></i></div>
            <div class="metric-label">Causa Principal</div>
            <div class="metric-big-text" id="causaPrincipal">---</div>
            <div class="metric-change" id="causaPrincipalCount">0 casos</div>
          </div>
        </div>

        <!-- Distribuci칩n Temporal -->
        <div class="temporal-distribution-section">
          <div class="temporal-header">
            <h4><i class="fas fa-chart-area"></i> Distribuci칩n Temporal de Incidentes</h4>
            <div class="temporal-controls">
              <div class="temporal-selector">
                <label><i class="fas fa-calendar-alt"></i> Per칤odo:</label>
                <select id="periodoDistribucion" onchange="actualizarDistribucionTemporal()">
                  <option value="mensual">Mensual</option>
                  <option value="trimestral">Trimestral</option>
                  <option value="anual">Anual</option>
                </select>
              </div>
              <button id="btnLimpiarFiltro" class="btn-limpiar-filtro" onclick="limpiarFiltroTemporal()" style="display: none;">
                <i class="fas fa-times-circle"></i> Limpiar Filtro
              </button>
            </div>
          </div>
          <div id="filtroActivoIndicador" class="filtro-activo-indicador" style="display: none;">
            <i class="fas fa-filter"></i> <span id="textoFiltroActivo"></span>
          </div>
          <div class="chart-card-temporal">
            <canvas id="chartDistribucionTemporal"></canvas>
          </div>
        </div>

        <!-- Gr치ficas principales -->
        <div class="charts-container">
          <div class="chart-card interactive" id="cardTiposSiniestro">
            <h4><i class="fas fa-car-crash"></i> Tipos de Siniestro</h4>
            <canvas id="chartTiposSiniestro"></canvas>
          </div>
          <div class="chart-card interactive" id="cardCausas">
            <h4><i class="fas fa-search"></i> Causas Principales</h4>
            <canvas id="chartCausas"></canvas>
          </div>
        </div>

        <!-- Gr치ficas adicionales -->
        <div class="charts-container-perfil">
          <div class="chart-card">
            <h4><i class="fas fa-user-friends"></i> Personas Involucradas</h4>
            <canvas id="chartPersonasInvolucradas"></canvas>
          </div>
          <div class="chart-card">
            <h4><i class="fas fa-users"></i> Clasificaci칩n de Fallecidos</h4>
            <canvas id="chartClasificacionFallecidos"></canvas>
          </div>
          <div class="chart-card interactive">
            <h4><i class="fas fa-road"></i> Tipos de Vialidad</h4>
            <canvas id="chartTiposVialidad"></canvas>
          </div>
        </div>
      </div>
    </section>

    <!-- Panel 3: An치lisis Cruzado -->
    <section class="analytics-panel">
      <button class="analytics-toggle" onclick="togglePanel('cruzado')">
        <span><i class="fas fa-project-diagram"></i> An치lisis Cruzado (Insights Avanzados)</span>
        <i class="fas fa-chevron-down" id="cruzadoToggleIcon"></i>
      </button>
      <div class="analytics-content" id="cruzadoContent" style="display: none;">
        
        <!-- Selector de an치lisis -->
        <div class="cross-analysis-selector">
          <label><i class="fas fa-filter"></i> Selecciona el tipo de an치lisis cruzado:</label>
          <select id="tipoAnalisisCruzado" onchange="actualizarAnalisisCruzado()">
            <option value="municipio_fallecidos">Letalidad por Municipio (Fallecidos vs Incidentes)</option>
            <option value="vialidad_tipo">Tipo de Siniestro por Tipo de Vialidad</option>
            <option value="dia_causa">Causa del Siniestro por D칤a de Semana</option>
            <option value="municipio_causa">Causa Principal por Municipio</option>
            <option value="vialidad_fallecidos">Letalidad por Tipo de Vialidad</option>
          </select>
        </div>
        
        <div class="chart-card-large">
          <canvas id="chartAnalisisCruzado"></canvas>
        </div>
        
        <!-- Insights autom치ticos -->
        <div class="insights-container">
          <h4><i class="fas fa-lightbulb"></i> Insights Detectados</h4>
          <div id="insightsList">
            <p class="loading-text">Analizando datos...</p>
          </div>
        </div>
      </div>
    </section>

    <!-- Panel 4: An치lisis de Transporte P칰blico -->
    <section class="analytics-panel">
      <button class="analytics-toggle" onclick="togglePanel('transporte')">
        <span><i class="fas fa-bus"></i> An치lisis de Transporte P칰blico</span>
        <i class="fas fa-chevron-down" id="transporteToggleIcon"></i>
      </button>
      <div class="analytics-content" id="transporteContent" style="display: none;">
        
        <!-- Vista General del Transporte P칰blico -->
        <div id="vistaGeneralTransporte">
          
          <!-- M칠tricas Generales -->
          <div class="transport-overview-header">
            <h3><i class="fas fa-chart-pie"></i> Panorama General del Transporte P칰blico</h3>
            <p class="transport-overview-description">An치lisis comparativo de todos los tipos de transporte p칰blico en Chiapas</p>
          </div>
          
          <div class="transport-metrics-grid">
            <div class="transport-metric-card">
              <div class="transport-metric-icon"><i class="fas fa-exclamation-triangle"></i></div>
              <div class="transport-metric-value" id="generalTotalIncidentes">0</div>
              <div class="transport-metric-label">Total de Incidentes</div>
              <div class="transport-metric-sublabel">Transporte p칰blico</div>
            </div>
            <div class="transport-metric-card">
              <div class="transport-metric-icon"><i class="fas fa-skull"></i></div>
              <div class="transport-metric-value" id="generalTotalFallecidos">0</div>
              <div class="transport-metric-label">Total de Fallecidos</div>
              <div class="transport-metric-sublabel">En transporte p칰blico</div>
            </div>
            <div class="transport-metric-card">
              <div class="transport-metric-icon"><i class="fas fa-percentage"></i></div>
              <div class="transport-metric-value" id="generalTasaLetalidad">0%</div>
              <div class="transport-metric-label">Tasa de Letalidad</div>
              <div class="transport-metric-sublabel">Fallecidos/Incidentes</div>
            </div>
            <div class="transport-metric-card">
              <div class="transport-metric-icon"><i class="fas fa-chart-line"></i></div>
              <div class="transport-metric-value" id="generalPorcentajeTotal">0%</div>
              <div class="transport-metric-label">Del Total General</div>
              <div class="transport-metric-sublabel">Todos los accidentes</div>
            </div>
          </div>
          
          <!-- Gr치ficas Generales -->
          <div class="transport-charts-container">
            <div class="transport-chart-card">
              <h4><i class="fas fa-balance-scale"></i> Comparaci칩n entre Tipos de Transporte</h4>
              <canvas id="chartComparacionTipos"></canvas>
            </div>
            <div class="transport-chart-card">
              <h4><i class="fas fa-heartbeat"></i> Distribuci칩n de Gravedad</h4>
              <canvas id="chartGravedadGeneral"></canvas>
            </div>
          </div>
          
          <div class="transport-charts-container">
            <div class="transport-chart-card">
              <h4><i class="fas fa-chart-line"></i> Evoluci칩n Temporal por Tipo</h4>
              <canvas id="chartEvolucionTemporal"></canvas>
            </div>
            <div class="transport-chart-card">
              <h4><i class="fas fa-calendar-week"></i> D칤as de la Semana m치s Peligrosos</h4>
              <canvas id="chartDiasSemanaTransporte"></canvas>
            </div>
          </div>
          
          <div class="transport-charts-container">
            <div class="transport-chart-card">
              <h4><i class="fas fa-road"></i> Tipo de Vialidad vs Tipo de Transporte</h4>
              <canvas id="chartVialidadTransporte"></canvas>
            </div>
            <div class="transport-chart-card">
              <h4><i class="fas fa-map-marked-alt"></i> Top 10 Municipios (Transporte P칰blico)</h4>
              <canvas id="chartMunicipiosTransporte"></canvas>
            </div>
          </div>
          
        </div>
        
        <!-- Selector de Tipo de Transporte -->
        <div class="transport-type-filter">
          <div class="transport-header">
            <h4><i class="fas fa-filter"></i> An치lisis Detallado por Tipo de Transporte</h4>
            <p class="transport-description">Selecciona un tipo para ver estad칤sticas espec칤ficas y detalladas</p>
          </div>
          
          <div class="transport-selector-grid">
            <label class="transport-card-selector" onclick="cambiarTransporteFiltro('colectivo')">
              <input type="radio" name="transportePublicoFiltro" value="colectivo" id="radioColectivo">
              <div class="transport-card-content">
                <div class="transport-icon">游뚧</div>
                <div class="transport-title">Colectivos</div>
                <div class="transport-count" id="countColectivos">0</div>
                <div class="transport-label">incidentes registrados</div>
              </div>
            </label>
            
            <label class="transport-card-selector" onclick="cambiarTransporteFiltro('taxi')">
              <input type="radio" name="transportePublicoFiltro" value="taxi" id="radioTaxi">
              <div class="transport-card-content">
                <div class="transport-icon">游뚯</div>
                <div class="transport-title">Taxis</div>
                <div class="transport-count" id="countTaxis">0</div>
                <div class="transport-label">incidentes registrados</div>
              </div>
            </label>
            
            <label class="transport-card-selector" onclick="cambiarTransporteFiltro('mototaxi')">
              <input type="radio" name="transportePublicoFiltro" value="mototaxi" id="radioMototaxi">
              <div class="transport-card-content">
                <div class="transport-icon">游띳</div>
                <div class="transport-title">Mototaxis</div>
                <div class="transport-count" id="countMototaxis">0</div>
                <div class="transport-label">incidentes registrados</div>
              </div>
            </label>
          </div>
          
          <button id="btnLimpiarTransporte" class="btn-limpiar-transporte" onclick="limpiarFiltroTransporte()" style="display: none;">
            <i class="fas fa-times-circle"></i> Volver a Vista General
          </button>
        </div>

        <!-- Contenedor Din치mico de Estad칤sticas Espec칤ficas -->
        <div id="transporteStatsContainer">
          <div class="transport-empty-state">
            <i class="fas fa-hand-pointer" style="font-size: 5em; color: #90caf9; margin-bottom: 25px;"></i>
            <p style="color: #666; font-size: 20px; font-weight: 700;">Selecciona un tipo de transporte para ver an치lisis detallado</p>
            <p style="color: #999; font-size: 16px; margin-top: 12px;">Haz clic en una de las tarjetas de arriba</p>
          </div>
        </div>

      </div>
    </section>

  </main>

  <!-- Pie de p치gina -->
  <footer>
    <div class="footer-content">
      <div class="footer-section">
        <h4>Secretar칤a de Movilidad y Transporte</h4>
        <p>Estado de Chiapas, M칠xico</p>
        <p style="margin-top: 10px; font-size: 14px; color: #999;">
        </p>
      </div>
      <div class="footer-section">
        <h4>S칤guenos en redes sociales</h4>
        <div class="social-links">
          <a href="https://www.facebook.com/share/16mbEXWtoj/?mibextid=wwXIfr" target="_blank" rel="noopener">
            <img src="facebook-icon.png" alt="Facebook" class="icono-facebook">
          </a>
          <a href="https://www.instagram.com/smyt_chiapas?igsh=MTdteHo3d2NlNmY3cA==" target="_blank" rel="noopener">
            <img src="instagram-icon.png" alt="Instagram" class="icono-instagram">
          </a>
        </div>
      </div>
    </div>
  </footer>

  <script src="estadisticas.js"></script>
</body>
</html>

